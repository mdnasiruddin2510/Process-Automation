@model App.Domain.ViewModel.NewStaff
@{
    ViewBag.Title = "NewStaff";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/App_Themes/Theme1/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
<link href="~/App_Themes/Theme1/plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
<link href="~/App_Themes/Theme1/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
<link href="~/App_Themes/Theme1/plugins/select2/select2.css" rel="stylesheet" type="text/css" />
<link href="~/Css/FormDesign.css" rel="stylesheet" />
@using (Html.BeginForm())
{
    <div class="row">
        <div class="col-md-11">
            <div class="panel panel-color panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <text style="text-align:left !important; text-decoration: none;">New Staff</text>
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="input-group form-group col-md-12">

                    </div>
                    <div class="col-md-12">
                        <div class="col-md-9">
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="StaffId" style="padding:initial;margin-right: -8px;">Staff Id</label>
                                    <div class="form-group col-md-2">
                                       @Html.TextBoxFor(x => x.Id, new { @class = "form-control", @Value = ViewBag.Id })
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="name" style="padding:initial;margin-right: -8px;">Staff Name</label>
                                    <div class="form-group col-md-8">
                                        @Html.TextBoxFor(x => x.Name, null, new { @class = "form-control", required = "required", maxlength = "50" })
                                        @Html.ValidationMessageFor(x => x.Name)
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="loginName" style="padding:initial;margin-right: -8px;">Login Name</label>
                                    <div class="form-group col-md-8">
                                        @Html.TextBoxFor(x => x.LoginName, null, new { @class = "form-control", required = "required", maxlength = "50" })
                                        @Html.ValidationMessageFor(x => x.LoginName)
                                    </div>
                                </div>
                              </div>
                            <div class="col-md-10">
                                    <div class="col-md-10">
                                        <label class="col-md-4" id="boundary" style="padding:initial;margin-right: -8px;">Boundary</label>
                                        <div class="input-group form-group col-md-8">
                                            @Html.DropDownListFor(x => x.BoundaryId, null, "--- Select ---", new { @class = "form-control select2", required = "required", @Value = ViewBag.BoundaryId })
                                            @Html.ValidationMessageFor(x => x.BoundaryId)
                                        </div>
                                    </div>
                                <div class="col-md-2" style="text-align:left">
                                    @*<input type="button" class="btn" value="Add" id="btnMark" />*@
                                    @*@Html.ActionLink("Add", "NewStaff", "NewStaff")*@
                                    <a href='@Url.Action("Boundary", "Boundary")'>
                                        <img src='@Url.Content("~/Images/Icons/addCircle.png")' align="middle" width="40" />
                                    </a>
                                </div>
                                </div>
                            <div class="col-md-10">
                                    <div class="col-md-10">
                                        <label class="col-md-4" id="reporting" style="padding:initial;margin-right: -8px;">Reporting To</label>
                                        <div class="input-group form-group col-md-8">
                                            @Html.DropDownListFor(x => x.ReportingId, null, "--- Select ---", new { @class = "form-control select2", required = "required", @Value = ViewBag.ReportingId })
                                            @Html.ValidationMessageFor(x => x.ReportingId)
                                        </div>
                                    </div>
                                @*<div class="col-md-2" style="text-align:left">
                                    <a href='@Url.Action("Boundary", "Boundary")'>
                                        <img src='@Url.Content("~/Images/Icons/addCircle.png")' align="middle" width="40" />
                                    </a>
                                </div>*@
                                </div>
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="email" style="padding:initial;margin-right: -8px;">Email</label>
                                    <div class="form-group col-md-8">
                                        @Html.TextBoxFor(x => x.Email, null, new { @class = "form-control", required = "required", maxlength = "50" })
                                        @Html.ValidationMessageFor(x => x.Email)
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="mobile" style="padding:initial;margin-right: -8px;">Mobile</label>
                                    <div class="form-group col-md-8">
                                        @Html.TextBoxFor(x => x.Mobile, null, new { @class = "form-control", required = "required", maxlength = "11" })
                                        @Html.ValidationMessageFor(x => x.Mobile)
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="password" style="padding:initial;margin-right: -8px;">Password</label>
                                    <div class="form-group col-md-7">
                                        @*<input type="password" pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$" title="Please include at least 1 uppercase character, 1 lowercase character, and 1 number." required>*@
                                        @Html.PasswordFor(x => x.Password, new { @class = "form-control", required = "required", maxlength = "50" })
                                        <span id="LngPas">Enter a password at least 1 uppercase,1 lowercase, at least 1 digit,at least 1 special character and  Minimum 8 characters.</span>
                                        @Html.ValidationMessageFor(x => x.Password)
                                    </div>
                                    <span toggle="#password-field" class="fa fa-fw fa-eye field_icon toggle-password"></span>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="col-md-10">
                                    <label class="col-md-4" id="confirm" style="padding:initial;margin-right: -8px;">Confirm Password</label>
                                    <div class="form-group col-md-7">
                                        @Html.PasswordFor(x => x.ConfirmPass, new { @class = "form-control", required = "required", maxlength = "50" })
                                        <span id="ConPassT">Please confirm your password</span>
                                    </div>
                                    <span toggle="#password-field" class="fa fa-fw fa-eye field_icon toggle-password1"></span>
                                </div>
                            </div>
                                <div class="row col-md-12" style="text-align:end">
                                    <div class="col-md-9" style=" text-align:right;overflow:hidden">
                                        <img id="myimageNewStaffSave" src='@Url.Content("~/Images/checked.png")' width="60" />
                                        <a href='@Url.Action("Index", "Home")'>
                                            <img src='@Url.Content("~/Images/Icons/next.png")' width="50" />
                                        </a>
                                    </div>
                                </div>

                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section scripts{
    <script src="~/App_Themes/Theme1/plugins/select2/select2.min.js" type="text/javascript"></script>
    <script src="~/App_Themes/Theme1/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/dataTables.bootstrap.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/buttons.bootstrap.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/pdfmake.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/vfs_fonts.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/buttons.html5.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/buttons.print.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/dataTables.fixedHeader.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/dataTables.keyTable.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/responsive.bootstrap.min.js"></script>
    <script src="../App_Themes/Theme1/plugins/datatables/dataTables.scroller.min.js"></script>
    <script type="text/javascript" src="../App_Themes/Theme1/plugins/parsleyjs/dist/parsley.min.js"></script>
    <!-- Datatable init js -->
    <script src="../App_Themes/Theme1/blue/assets/pages/datatables.init.js"></script>
    <script>
    $(document).ready(function () {
        $("#BoundaryId").select2();
        $("#ReportingId").select2();
        $(document).on('click', '.toggle-password', function () {

            $(this).toggleClass("fa-eye fa-eye-slash");
            var x = document.getElementById("Password");
            if (x.type === "password") {
                x.type = "text";
            } else {
                x.type = "password";
            }

        });

        $(document).on('click', '.toggle-password1', function () {

            $(this).toggleClass("fa-eye fa-eye-slash");
            var x = document.getElementById("ConfirmPass");
            if (x.type === "password") {
                x.type = "text";
            } else {
                x.type = "password";
            }

        });

        var loadInfo = {
            StaffId: "",
            StaffName: "",
            LoginName: "",
            BoundaryId: "",
            ReportingId: "",
            Email: "",
            Mobile: "",
            Password: "",
            ConfirmPass: ""
        };
        function setOrder() {
            loadInfo.StaffId = $("#Id").val();
            loadInfo.StaffName = $("#Name").val();
            loadInfo.LoginName = $("#LoginName").val();
            loadInfo.BoundaryId = $("#BoundaryId").val();
            loadInfo.ReportingId = $("#ReportingId").val();
            loadInfo.Email = $("#Email").val();
            loadInfo.Mobile = $("#Mobile").val();
            loadInfo.Password = $("#Password").val();
            loadInfo.ConfirmPass = $("#ConfirmPass").val();
        }
        function ClearStaff() {
            $("#Name").val("");
            $("#LoginName").val("");
            $("#BoundaryId").val().trigger('change.select2');
            $("#ReportingId").val().trigger('change.select2');
            $("#Email").val("");
            $("#Mobile").val("");
            $("#Password").val("");
            $("#ConfirmPass").val("");
        }

        function validateOnSave(validOrder) {

            if (!validOrder.LoginName.trim().length) {
                return "Please write a Name.";
            }
            if (!validOrder.BoundaryId.trim().length) {
                return "Please select a Boundary.";
            }
            if (!validOrder.Password.trim().length) {
                return "Please write a Password.";
            }
            if (!validOrder.BoundaryId.trim().length) {
                return "Please Conform your Password.";
            }
            if (!validOrder.Email.trim().length) {
                return "Please write your Email.";
            }
            if (!validOrder.Mobile.trim().length) {
                return "Please write your Mobile No.";
            }
            return "";
        }
        $(document).on("click", "#myimageNewStaffSave", function () {
            setOrder();
            var validate = validateOnSave(loadInfo);
            if (validate != "") {
                alert(validate);
                return;
            }
            $.ajax({
                url: '@Url.Action("SaveNewStaff", "NewStaff")',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({ newStaff: loadInfo }),
                type: 'POST',
                dataType: 'json',
                success: function (datas) {
                    if (datas == 1) {
                        swal({
                            title: "Ok",
                            text: "Save Successfully!",
                            type: "success",
                            closeOnConfirm: true
                        }, function () {
                            location.reload();
                            ClearStaff();
                        });
                        $("#save").prop("disabled", false);
                    }
                    else if (datas == "X") {
                        swal({
                            title: "Sorry",
                            text: "No Save Permission for this User",
                            type: "warning"
                        });
                    }
                    else if (datas == 0) {
                        swal(
                            'Sorry!',
                            'All (*) field are required. These Fields can not be empty!!!',
                            'warning'
                        );
                        $("#save").prop("disabled", false);
                    }
                    else {
                        swal("This item already exists!!! Please enter another item!!!", "fail")
                    }

                }
            });
        });

        var $password = $('#Password');
        var $confirmPassword = $('#ConfirmPass');

        // Hide hints by default on load
        // $("form span").hide();

        // Check if entered password meets requirements (True or False)
        function isPasswordValid() {
            return $password.val().length >= 8 && $password.val().match(/[A-Z]/g) && $password.val().match(/[a-z]/g) && $password.val().match(/[0-9]/g) && $password.val().match(/[^a-zA-Z\d]/g);
        }

        // Check if password fields match (True or False)
        function arePasswordsMatching() {
            return $password.val() === $confirmPassword.val();
        }

        // Check if passwords are both valid and matching (True or False)
        function canSubmit() {
            return isPasswordValid() && arePasswordsMatching();
        }

        // Hide hint if password valid, show if not valid
        function passwordEvent() {
            if (isPasswordValid()) {
                $password.next().hide();
            } else {
                $password.next().show();
            }
        }

        // Hide hint if both password fields match, show if fields do not match
        function passwordConfirmation() {
            if (arePasswordsMatching()) {
                $confirmPassword.next().hide();
            } else {
                $confirmPassword.next().show();
            }
        }

        // Enable submit button when passwords are both valid and matching
        function enableSubmit() {

            var isSaveVisible = $('#myimageNewStaffSave').is(':visible');
            //var isUpdateVisible = $('#btnUpdateUsrInfo').is(':visible');

            if (isSaveVisible == true) {
                $("#myimageNewStaffSave").prop("disabled", !canSubmit());
            }
            else if (isUpdateVisible == true) {
                $("#btnUpdateUsrInfo").prop("disabled", !canSubmit());
            }
        }

        $password.focus(passwordEvent).keyup(passwordEvent).keyup(passwordConfirmation).keyup(enableSubmit);

        $confirmPassword.focus(passwordConfirmation).keyup(passwordConfirmation).keyup(enableSubmit);

    });
    </script>
    }

